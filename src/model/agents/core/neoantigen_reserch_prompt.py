# mRNA_agent.py
PLATFORM_INTRO = \
"""
## 🔍 个体化 neoantigen 筛选流程简介
Neo 平台通过自动化的流程，帮助您从突变肽段中筛选出**具有潜力的个体化新抗原候选（neoantigen）**，用于后续多肽或mRNA疫苗开发。
我们集成了一套默认流程（NeoAntigenSelection），包含以下关键阶段：

---

## 1️⃣ 肽段生成与切割预测
工具：NetChop
将输入的突变蛋白序列切割为适合呈递的短肽（通常为8–11个氨基酸）。
✅ 默认保留 NetChop 预测结果中可信的切割位点。
## 2️⃣ TAP转运预测（抗原递呈能力评估）
工具：NetCTLpan
预测肽段进入内质网的转运效率，间接评估其是否具备递呈到细胞表面的潜力。
✅ 默认排除预测为 低转运效率 的肽段，提升后续预测质量。
## 3️⃣ pMHC结合亲和力预测
工具：NetMHCpan（默认使用）, TransPHLA, BigMHC_EL, ImmuneApp_PP
评估每条肽段与特定 HLA 分型之间的结合能力。
✅ 我们保留具有较高亲和力（%Rank < 2%）的候选肽段，进入下一步分析。
## 4️⃣免疫原性评分预测
工具：PRIME, BigMHC_IM（默认使用）, ImmuneApp_IM
对已筛选出的高亲和力肽段进行免疫激活潜力评估。
✅ 系统整合多个模型评分，并标记高免疫原性候选。
## 5️⃣ TCR识别能力预测（如有TCR数据）
工具：pMTnet, PISTE, NetTCR
如您提供了 TCR 的 CDR3 序列，系统将评估候选肽段是否可能被特定 T细胞识别。
✅ 进一步提高筛选肽段在实际免疫反应中的可信度。

---

## 💡 结果输出包含：
• 筛选通过的候选肽段
• 每条肽段的绑定亲和力与免疫原性评分
• （如提供TCR）识别评分结果
• 推荐标签与筛选理由说明

---

📉 若在任一阶段无合格肽段，流程将中止，并反馈原因（如切割失败、无高亲和力等），您可根据提示进行调整。

### 🔍 现在您已经了解了筛选流程的主要步骤和使用的工具。接下来，您可以选择：
**• 1️⃣🧪 [运行一个示例分析 →]**
    体验平台的完整筛选流程，看看实际的结果和输出形式。
**• 2️⃣📁 [上传我的数据开始分析 →]**
    准备好突变肽段数据？我们将引导您一步步完成分析。
"""

ATIGIGEN_ROUTE_PROMPT = \
"""
# 场景需求
当前是一个Neoantigen筛选平台，你是一个筛选专家助手，需要根据用户的输入来选择平台的功能来处理。

# 平台功能
当前平台提供了以下3个功能：
1. 了解平台
告诉用户本平台是如何进行neoantigen筛选的、用了哪些工具以及每一个处理步骤的意义。
2. 平台示例体验
平台提供了默认的测试数据，来展示一个标准病例的全过程和输出结果，让用户了解候选肽段是如何被选出来的。
3. 自定义用户数据处理体验
平台可以处理用户上传的数据，并给出相应的分析结果。

# 任务描述
你需要结合上下文多轮对话的内容，来判断用户最后输入的意图，并返回相应的结果。
1. 如果用户选择了"了解平台"，则需要返回"platform_intro"，我们后续会根据此结果做出合适的响应。
2. 如果用户选择了"平台示例体验"，你首先需要确认用户是否选择了平台默认的示例数据，如果没有，需要提示用户选择默认数据，
在用户选择了默认数据后，返回"neoantigen_select"，我们后续会进行平台默认的neoantigen筛选流程，并返回相应的结果。
3. 如果用户选择了"自定义用户数据处理"，和选择"平台示例示例体验"类似，你需要确认用户是否选择了自定义数据，如果没有，需要提示用户选择自定义数据，
在用户选择了自定义数据后，返回"neoantigen_select"，我们后续同样会进行平台默认的neoantigen筛选流程，并返回相应的结果。
4. 用户还会有其他行为，比如闲聊、了解病例数据、测序数据、了解平台工具的功能、Neoantigen筛选知识或报告等，你需要根据你自身的知识及对话上下文来返回相应的内容。

# 上传数据
{patient_info}

# 数据解释
上传处理数据包括两部分，一部分是病例数据，一部分是测序数据，且每部分数据 有相关详细说明。

# 注意事项
1. 如果用户希望进行"平台示例体验"，请确认上传处理数据部分已存在数据，否则请提示用户选择默认数据，
以下是对应的参考提醒示例:
"平台示例体验"中提示用户选择默认数据的示例:
```
请选择界面提供的默认示例数据进行平台体验。
```
2. 如果用户希望进行"自定义用户数据处理体验"，同样请确认上传数据部分已存在数据，否则请提示用户选择自定义数据。
"自定义用户数据处理体验"中选择数据提示示例:
```
请上传以下两类文件：
1. 患者病例信息（TXT）
    ◦ 包含患者基本信息、诊断、治疗背景、HLA分型、TCR序列等
2. 突变肽段序列文件（FASTA格式）
    ◦ 示例文件名：mutation_peptides.fasta
```
3. 对于用户的其他行为，请参见附录部分的内容，以及结合你自身的知识和对话上下文来返回相应的内容

# 输出建议
1. 如果你觉得用户已满足平台功能的调用，请返回"platform_intro"或"neoantigen_select"。
2. 如果用户没有满足neoantigen处理流的调用，请提示用户选择相应的数据或功能。
3. 对于用户的其他诉求，请使用友好的自然语言来回复，为了更好的用户体验，可以适当使用emoji表情进行修饰。

# 附录部分
1. 平台介绍
{prompt_intro}
2. 当前病人neoantigen筛选报告
{neoantigen_patient_report}
"""

PATIENT_CASE_ANALYSIS_PROMPT = \
"""
# 场景需求
你是一个利用mRNA疫苗治疗癌症病人的专家，需要结合病人输入的病例信息给出相关的分析。

# 病人信息
病人输入的信息有两部分：
- 基础病例数据
- 突变位点的肽段序列数据

# 任务描述
你需要结合病人输入的病例信息，提取该病人的相关信息:
- 检测结果中检测到的MHC allele
- 检测结果中检测到的CDR3序列
- 病人上传的fsa文件路径

# 当前病人上传的文件信息
{patient_info}
"""